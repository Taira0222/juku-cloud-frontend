# 🚦 GitHub Copilot へのレビュー指示（改訂版）

> **目的**: 重要度と意図が一目で分かり、レビューの抜け漏れを減らす。

---

## 🌐 コメントの言語

- **すべて日本語** で記述してください。

---

## 🏷️ コメントの分類ルール

レビューコメントは、以下いずれかのラベルを**先頭に付与**してください（複数可）。

- 🔴 **`[must]`**: _必ず修正_。バグ、セキュリティ、仕様違反、実行時例外、データ破壊、重大なアクセシビリティ欠陥など。
- 🧩 **`[logic]`**: _ロジック設計の問題_。動くが、アルゴリズム選定/責務分離/例外網羅性/境界条件の扱い/スケーラビリティに懸念。
- 🟡 **`[imo]`**: _改善提案（任意）_。可読性、保守性、パフォーマンスの軽微な向上、抽象化や命名の改善など。
- ⚪ **`[nits]`**: _ささいな指摘_。コードスタイル、余分な空行、スペル、並び順など。
- ❓ **`[ask]`**: _質問_。設計意図や仕様確認、前提共有のお願い。
- 📎 **`[fyi]`**: _参考情報_。関連 Docs/Issue/PR へのリンク、背景知識、将来的な注意点。

> **使い分けの目安**: 実害やリスクが**現在**発生/高確率 → `[must]`。将来劣化や非効率の**可能性** → `[logic]` or `[imo]`。見た目・表記揺れ → `[nits]`。

---

## 📝 コメント例

- 🔴 **`[must]`** この入力は未サニタイズです。XSS リスクがあるため `DOMPurify` 相当で無害化してください。
- 🧩 **`[logic]`** このループは O(n^2) で、データ 1 万件で遅延が顕著になります。`Set` を使うと重複除去が O(n) になります。
- 🟡 **`[imo]`** バリデーションと保存処理の責務が混在しています。`validate()` を分離するとテスト容易性が上がります。
- ⚪ **`[nits]`** インデントが 2→4 にぶれています。プロジェクト設定に合わせてください。
- ❓ **`[ask]`** 空配列のときの挙動を仕様として許容していますか？UI の表示はどうなりますか？
- 📎 **`[fyi]`** ライブラリ v2.3 で型改善が入りました。将来の移行候補として共有です。

---

## 🔍 レビューポイント・チェックリスト

**設計/ロジック**

- 境界値・例外系（null/undefined/空配列/タイムアウト/再試行）を網羅しているか。
- アルゴリズムの計算量、データサイズ増大時の劣化は許容範囲か。
- 責務分離（UI/状態管理/副作用/入出力/バリデーション）が適切か。
- 非同期処理（await/並列化/キャンセル/競合状態）の取り扱いは安全か。

**型/契約**

- TypeScript の型は **狭く安全** か（`unknown`→`zod` で絞る、`any` 回避）。
- API 契約（リクエスト/レスポンス）はスキーマで検証しているか（zod/Valibot 等）。

**テスト**

- 仕様変更に対する **テストの追加/更新** があるか（成功/失敗/境界/非同期）。
- モック（MSW 等）の振る舞いが**実 API と乖離**していないか。

**品質**

- エラー処理・再試行・ロギング・ユーザ通知（トースト/リトライ手段）。
- セキュリティ（XSS/CSRF/認可境界/機密情報ログ出力抑止）。
- アクセシビリティ（role/aria/フォーカス/キーボード操作）。
- パフォーマンス（メモ化、不要再レンダー、依存配列、React Query キャッシュ戦略）。

---

## 🧪 スタイルガイド

- **インデント 2 スペース**。
- TS/TSX のスタイルはプロジェクト設定に準拠（ESLint/Prettier/Rubocop）。
- デバッグ用 `console.log` は削除。必要なログは `logger` を用いレベル管理。
- import はグループ化（標準/外部/内部）し、未使用の import を排除。
- 命名: 意図が伝わる英語、略語はプロジェクト辞書に従う。

---

## 💬 指摘の書き方（テンプレ）

```
[<label>] <一言サマリ>
背景: <前提/再現手順/関連仕様>
問題: <何が/どこで/いつ/どれくらい>
理由: <なぜ問題か（ユーザ影響/保守/安全性）>
提案: <具体的な修正案 or 参考リンク>
```

**例**

```
[logic] フィルタ後に sort しているため O(n log n) が 2 回走っています。
背景: students を学年→氏名で表示
問題: n=5,000 で描画遅延
理由: filter→sort→map を 2 系統で実行
提案: 事前にキーを正規化し、1 回の sort で済む配列構造に変更
```

---

## 🗂️ 重大度 × 優先度の目安

| ラベル        | 重大度  | 影響                           | 対応目安           |
| ------------- | ------- | ------------------------------ | ------------------ |
| `[must]`      | 致命/高 | 即時障害/セキュリティ/仕様逸脱 | **今すぐ修正**     |
| `[logic]`     | 中/高   | 将来の不具合/性能劣化/責務肥大 | **優先修正**       |
| `[imo]`       | 中      | 読みやすさ/保守性の向上        | 次のタスクで対応可 |
| `[nits]`      | 低      | 表記/スタイル                  | 随時               |
| `[ask]/[fyi]` | -       | 情報共有                       | 必要に応じて       |

---

## ⚙️ CI 連携（オプション）

- PR ボディに `[must]: N 件` を自動集計し、**0 件以外は CI を fail**。
- `danger` などで `console.log` や未使用 import を検出し自動コメント。
- MSW スキーマと OpenAPI の**差分チェック**で契約ずれを検知。

---

## 🧰 Copilot 対応のヒント

- ラベルは **先頭** に必ず付与（例: `[logic] XXX`）。
- 例は **具体的に**。主観のみの「微妙」は避け、データ/再現/計測を添える。
- 迷ったらまず `[ask]` で意図を確認 → 問題確定後に `[must]/[logic]` へ。

---

## ✅ レビュアー用最終チェック

- [ ] ラベルは付与されているか？
- [ ] 影響範囲・再現手順は明記されているか？
- [ ] 具体的な修正案または参考が提示されているか？
- [ ] テストや型の更新は必要十分か？
- [ ] セキュリティ/アクセシビリティの観点を見落としていないか？
