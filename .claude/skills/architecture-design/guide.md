# architecture-design スキル使用ガイド

## 目的

システム全体の技術的な構造を定義し、技術選定、コンポーネント設計、インフラ構成を明確化します。

## 作成するドキュメント

`docs/architecture.md`

## 作成ガイドライン

### インプット
1. `docs/product-requirements.md` を読み込む
2. `docs/functional-design.md` を読み込む
3. 非機能要件を技術的に実現する方法を設計

### 記載のポイント

#### 技術選定

技術選定は以下の観点で評価し、明確な理由を記載します。

##### 選定基準
1. **要件適合性**: 機能要件・非機能要件を満たせるか
2. **学習コスト**: チームの習熟度、学習曲線の急峻さ
3. **エコシステム**: ライブラリの充実度、コミュニティの活発さ
4. **パフォーマンス**: 速度、メモリ使用量、バンドルサイズ
5. **保守性**: 長期サポート、アップデート頻度、バグ対応
6. **開発効率**: 開発速度、デバッグのしやすさ
7. **コスト**: ライセンス費用、運用コスト

##### 技術選定マトリックス例

| 技術カテゴリ | 選択肢 | 要件適合 | 学習コスト | エコシステム | パフォーマンス | 総合評価 | 選定結果 |
|------------|-------|---------|-----------|------------|--------------|---------|---------|
| 状態管理 | Redux Toolkit | ◎ | △ | ◎ | ○ | ○ | - |
| 状態管理 | Zustand | ○ | ◎ | ○ | ◎ | ◎ | ✓ 採用 |
| 状態管理 | Jotai | ○ | ◎ | △ | ◎ | ○ | - |

**評価**: ◎=優秀 ○=良好 △=要改善 ×=不適

##### 選定時の注意点
- **プロジェクト規模を考慮**: 小〜中規模なら軽量なライブラリを優先
- **開発期間の制約**: 6ヶ月以内のMVPリリースなら習熟済みの技術を優先
- **チームスキル**: 新技術導入はリスク。既存スキルを活かせる選択肢を検討
- **トレードオフを明示**: 選定理由だけでなく、採用しなかった理由も記載

#### アーキテクチャ図

以下の図を含めることを推奨します。

##### 必須の図
- **全体アーキテクチャ図**: システム全体の構成要素と関係性
- **ER図**: 実際のドメインモデル（LessonNote、StudentTrait、Grade、User等）
- **データフロー図**: ユーザーアクション → UI → API → ストアの流れ

##### 推奨される図
- **コンポーネント階層図**: Reactコンポーネントの構造
- **認証フロー**: ログインからトークン管理までのシーケンス図
- **デプロイメント図**: インフラ構成とネットワーク

##### 作成時の注意点
- Mermaid記法を使用（コードとして管理可能）
- レイヤー間の依存関係を明確に（上位→下位のみ）
- 外部システム（Rails API）との連携を明示
- 図のタイトルと説明を必ず記載

#### スケーラビリティ

PRDの非機能要件（同時100ユーザー）を実現する戦略を記載します。

##### フロントエンド
- **コード分割**: React.lazyによる動的インポート
- **キャッシュ戦略**: TanStack Queryのキャッシュ、Service Worker
- **CDN活用**: 静的アセットの配信
- **バンドルサイズ最適化**: Tree shaking、最小化

##### バックエンド連携
- **APIレスポンス最適化**: ページネーション、フィールド選択
- **並列リクエスト**: Promise.allによる並行処理
- **楽観的更新**: UIの即時反映でUX向上

##### パフォーマンス目標との対応
- **ページロード≤2秒**: コード分割 + CDN + キャッシュ
- **API応答≤500ms**: バックエンド側の最適化に依存
- **同時100ユーザー**: 静的ファイル配信でサーバー負荷軽減

#### セキュリティ

OWASP Top 10を基準に、以下の対策を記載します。

##### 認証・認可
- **JWT**: トークンベース認証（Rails APIと連携）
- **ロールベースアクセス制御（RBAC）**: 教師/管理者の権限分離
- **トークン管理**: HttpOnly Cookie または LocalStorage（XSS対策と利便性のトレードオフ）

##### 入力検証
- **クライアント側**: Zodによるバリデーション
- **サーバー側**: Rails側での再検証（クライアント側は突破可能）

##### 攻撃対策
- **XSS**: Reactのエスケープ機構、DOMPurify（必要時）
- **CSRF**: SameSite Cookie、CSRFトークン（Rails側）
- **SQLインジェクション**: バックエンド（Rails）のORM使用

##### データ保護
- **HTTPS強制**: すべての通信を暗号化
- **個人情報**: 最小限の保持、適切な暗号化（バックエンド側）
- **ログ管理**: 個人情報をログに含めない

### 出力形式
- マークダウン形式
- 図表を豊富に使用
- 技術的根拠を明記
- 代替案とトレードオフを記載

## 注意事項

- 過剰設計を避ける(YAGNI原則)
- 実績のある技術を優先
- チームの習熟度を考慮
- コストとベネフィットのバランス
- 運用負荷を考慮
